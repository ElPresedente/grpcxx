#include "grpcxx.h"

#include <fmt/core.h>
#include <google/protobuf/descriptor.h>
#include <google/protobuf/io/coded_stream.h>
#include <google/protobuf/io/zero_copy_stream.h>

bool Grpcxx::Generate(
	const google::protobuf::FileDescriptor *file, const std::string &parameter,
	google::protobuf::compiler::GeneratorContext *context, std::string *error) const {

	std::string output = fmt::format(
		R"(// Code generated by protoc-gen-grpcxx.
// Versions:
//   - protoc-gen-grpcxx: {}

#pragma once
)",
		"0.0.0");

	std::unique_ptr<google::protobuf::io::ZeroCopyOutputStream> ostream(
		context->Open(google::protobuf::compiler::StripProto(file->name()) + ".grpcxx.pb.h"));

	google::protobuf::io::CodedOutputStream costream(ostream.get());
	costream.WriteRaw(output.data(), output.size());

	return true;
}
